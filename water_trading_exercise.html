<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Water Trading Exercise</title>
<link href="https://fonts.googleapis.com/css2?family=Source+Sans+3:wght@400;600;700&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #f5f3ee;
    --card-bg: #ffffff;
    --text: #2c2c2c;
    --text-muted: #6b6b6b;
    --border: #d4d0c8;
    --accent: #2d6a4f;
    --accent-light: #d8f3dc;
    --input-bg: #fefcf7;
    --input-border: #b8b3a7;
    --input-focus: #2d6a4f;
    --correct: #2d6a4f;
    --correct-bg: #d8f3dc;
    --incorrect: #c1121f;
    --incorrect-bg: #fde8e8;
    --computed-bg: #f0ede6;
    --header-bg: #2d6a4f;
    --header-text: #ffffff;
    --price-col: #f7f5f0;
    --row-hover: #faf8f3;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Source Sans 3', system-ui, sans-serif;
    background: var(--bg);
    color: var(--text);
    line-height: 1.5;
    padding: 2rem 1rem;
  }

  .container {
    max-width: 1100px;
    margin: 0 auto;
  }

  .header {
    margin-bottom: 2rem;
  }

  .header h1 {
    font-size: 1.6rem;
    font-weight: 700;
    color: var(--accent);
    margin-bottom: 0.5rem;
    letter-spacing: -0.02em;
  }

  .scenario {
    background: var(--card-bg);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 1.25rem 1.5rem;
    margin-bottom: 1.5rem;
    font-size: 0.95rem;
    line-height: 1.7;
  }

  .scenario strong {
    color: var(--accent);
  }

  .scenario .question {
    font-weight: 700;
    font-size: 1.05rem;
    margin-bottom: 0.5rem;
    color: var(--text);
  }

  .scenario ul {
    margin: 0.5rem 0 0 1.2rem;
    list-style: disc;
  }

  .scenario li {
    margin-bottom: 0.2rem;
  }

  .table-wrapper {
    overflow-x: auto;
    border-radius: 8px;
    border: 1px solid var(--border);
    background: var(--card-bg);
    margin-bottom: 1.5rem;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.9rem;
    min-width: 900px;
  }

  thead th {
    background: var(--header-bg);
    color: var(--header-text);
    font-weight: 600;
    padding: 0.7rem 0.6rem;
    text-align: center;
    font-size: 0.82rem;
    letter-spacing: 0.01em;
    border-right: 1px solid rgba(255,255,255,0.15);
    white-space: nowrap;
  }

  thead th:last-child { border-right: none; }

  thead th.input-col {
    background: #1b4332;
  }

  tbody td {
    padding: 0.55rem 0.6rem;
    text-align: center;
    border-bottom: 1px solid var(--border);
    border-right: 1px solid #eae7e0;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.85rem;
    transition: background 0.2s;
  }

  tbody td:last-child { border-right: none; }

  tbody tr:last-child td { border-bottom: none; }

  tbody tr:hover { background: var(--row-hover); }

  td.price-cell {
    background: var(--price-col);
    font-weight: 700;
    color: var(--accent);
    width: 70px;
  }

  td.input-cell {
    background: var(--input-bg);
    padding: 0.3rem;
    width: 90px;
  }

  td.input-cell input {
    width: 100%;
    max-width: 70px;
    padding: 0.4rem 0.5rem;
    border: 2px solid var(--input-border);
    border-radius: 5px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.88rem;
    text-align: center;
    background: #fff;
    color: var(--text);
    transition: border-color 0.2s, box-shadow 0.2s;
    outline: none;
  }

  td.input-cell input:focus {
    border-color: var(--input-focus);
    box-shadow: 0 0 0 3px rgba(45,106,79,0.15);
  }

  td.input-cell input.correct {
    border-color: var(--correct);
    background: var(--correct-bg);
  }

  td.input-cell input.incorrect {
    border-color: var(--incorrect);
    background: var(--incorrect-bg);
  }

  td.computed {
    background: var(--computed-bg);
    color: var(--text-muted);
    font-size: 0.83rem;
  }

  td.computed.filled {
    color: var(--text);
  }

  td.profit-cell {
    text-align: left;
    padding-left: 0.8rem;
    font-size: 0.78rem;
    white-space: nowrap;
  }

  .actions {
    display: flex;
    gap: 1rem;
    align-items: center;
    flex-wrap: wrap;
  }

  button {
    font-family: 'Source Sans 3', sans-serif;
    font-weight: 600;
    font-size: 0.95rem;
    padding: 0.65rem 1.5rem;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    transition: transform 0.1s, box-shadow 0.15s, background 0.2s;
  }

  button:active { transform: scale(0.97); }

  .btn-check {
    background: var(--accent);
    color: white;
    box-shadow: 0 2px 6px rgba(45,106,79,0.25);
  }

  .btn-check:hover {
    background: #235c43;
    box-shadow: 0 3px 10px rgba(45,106,79,0.3);
  }

  .btn-reset {
    background: transparent;
    color: var(--text-muted);
    border: 1px solid var(--border);
  }

  .btn-reset:hover {
    background: #eee;
  }

  .btn-hint {
    background: transparent;
    color: var(--accent);
    border: 1px solid var(--accent);
  }

  .btn-hint:hover {
    background: var(--accent-light);
  }

  .feedback {
    margin-top: 1rem;
    padding: 1rem 1.25rem;
    border-radius: 8px;
    font-size: 0.95rem;
    display: none;
    line-height: 1.6;
  }

  .feedback.show { display: block; }

  .feedback.success {
    background: var(--correct-bg);
    border: 1px solid var(--correct);
    color: #1b4332;
  }

  .feedback.partial {
    background: #fff8e6;
    border: 1px solid #d4a017;
    color: #6b5900;
  }

  .feedback.error {
    background: var(--incorrect-bg);
    border: 1px solid var(--incorrect);
    color: #7a0c14;
  }

  .hint-box {
    margin-top: 1rem;
    padding: 1rem 1.25rem;
    border-radius: 8px;
    background: #eef6ff;
    border: 1px solid #a3c4e9;
    color: #1a3a5c;
    font-size: 0.9rem;
    display: none;
    line-height: 1.7;
  }

  .hint-box.show { display: block; }

  .score-badge {
    display: inline-block;
    font-weight: 700;
    font-size: 1.1rem;
    margin-right: 0.5rem;
  }

  @media (max-width: 640px) {
    body { padding: 1rem 0.5rem; }
    .header h1 { font-size: 1.3rem; }
    .scenario { padding: 1rem; font-size: 0.9rem; }
  }
</style>
</head>
<body>

<div class="container">
  <div class="header">
    <h1>Water Market Exercise</h1>
  </div>

  <div class="scenario">
    <div class="question">At each price, how many ML would you BUY (+) or SELL (−)?</div>
    You farm <strong>10 HA of rice</strong> and <strong>10 HA of citrus</strong> in the North basin. You have an entitlement for <strong>150 ML</strong> of water for the year.
    <ul>
      <li>Your citrus requires <strong>6 ML/HA</strong> and yields <strong>$220 per ML</strong> applied</li>
      <li>Your rice requires <strong>12 ML/HA</strong> and yields <strong>$160 per ML</strong> applied</li>
    </ul>
  </div>

  <div class="table-wrapper">
    <table id="exercise-table">
      <thead>
        <tr>
          <th>Price<br>per ML</th>
          <th class="input-col">HA cultivated<br>citrus</th>
          <th>ML for citrus<br>(HA × 6)</th>
          <th class="input-col">HA cultivated<br>rice</th>
          <th>ML for rice<br>(HA × 12)</th>
          <th>ML<br>needed</th>
          <th>ML bought<br>(needed − 150)</th>
          <th>Profit</th>
        </tr>
      </thead>
      <tbody id="table-body">
      </tbody>
    </table>
  </div>

  <div class="actions">
    <button class="btn-check" onclick="checkAnswers()">Check My Answers</button>
    <button class="btn-hint" onclick="toggleHint()">Show Hint</button>
    <button class="btn-reset" onclick="resetAll()">Reset</button>
  </div>

  <div class="hint-box" id="hint-box">
    <strong>Thinking it through:</strong> At each price, decide which crops are worth growing. A crop is worth cultivating if its <strong>yield per ML</strong> is greater than the market price (because you'd earn more using the water on the crop than selling it). If a crop isn't worth growing, set its HA to 0.
  </div>

  <div class="feedback" id="feedback"></div>
</div>

<script>
// Correct answers: [price, HA_citrus, HA_rice]
const correctData = [
  { price: 100,  ha_citrus: 10, ha_rice: 10 },
  { price: 125,  ha_citrus: 10, ha_rice: 10 },
  { price: 150,  ha_citrus: 10, ha_rice: 10 },
  { price: 175,  ha_citrus: 10, ha_rice: 0  },
  { price: 200,  ha_citrus: 10, ha_rice: 0  },
  { price: 225,  ha_citrus: 0,  ha_rice: 0  },
  { price: 250,  ha_citrus: 0,  ha_rice: 0  },
  { price: 275,  ha_citrus: 0,  ha_rice: 0  },
  { price: 300,  ha_citrus: 0,  ha_rice: 0  },
];

const ENTITLEMENT = 150;
const CITRUS_ML_PER_HA = 6;
const RICE_ML_PER_HA = 12;
const CITRUS_YIELD = 220;
const RICE_YIELD = 160;

function buildTable() {
  const tbody = document.getElementById('table-body');
  tbody.innerHTML = '';
  correctData.forEach((row, i) => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td class="price-cell">$${row.price}</td>
      <td class="input-cell">
        <input type="number" id="citrus_${i}" min="0" max="10" step="1" placeholder="0–10"
               oninput="computeRow(${i})" aria-label="HA citrus at $${row.price}">
      </td>
      <td class="computed" id="ml_citrus_${i}">—</td>
      <td class="input-cell">
        <input type="number" id="rice_${i}" min="0" max="10" step="1" placeholder="0–10"
               oninput="computeRow(${i})" aria-label="HA rice at $${row.price}">
      </td>
      <td class="computed" id="ml_rice_${i}">—</td>
      <td class="computed" id="ml_needed_${i}">—</td>
      <td class="computed" id="ml_bought_${i}">—</td>
      <td class="computed profit-cell" id="profit_${i}">—</td>
    `;
    tbody.appendChild(tr);
  });
}

function computeRow(i) {
  const citrusInput = document.getElementById(`citrus_${i}`);
  const riceInput = document.getElementById(`rice_${i}`);
  const ha_c = parseFloat(citrusInput.value);
  const ha_r = parseFloat(riceInput.value);
  const price = correctData[i].price;

  // Clear feedback styling on edit
  citrusInput.classList.remove('correct', 'incorrect');
  riceInput.classList.remove('correct', 'incorrect');

  const cells = ['ml_citrus', 'ml_rice', 'ml_needed', 'ml_bought', 'profit'];
  
  if (isNaN(ha_c) && isNaN(ha_r)) {
    cells.forEach(c => {
      const el = document.getElementById(`${c}_${i}`);
      el.textContent = '—';
      el.classList.remove('filled');
    });
    return;
  }

  const hc = isNaN(ha_c) ? 0 : ha_c;
  const hr = isNaN(ha_r) ? 0 : ha_r;

  const ml_c = hc * CITRUS_ML_PER_HA;
  const ml_r = hr * RICE_ML_PER_HA;
  const ml_needed = ml_c + ml_r;
  const ml_bought = ml_needed - ENTITLEMENT;

  // Profit calculation
  const revenue_citrus = CITRUS_YIELD * ml_c;
  const revenue_rice = RICE_YIELD * ml_r;
  let profit;
  if (ml_bought > 0) {
    profit = revenue_citrus + revenue_rice - price * ml_bought;
  } else {
    profit = revenue_citrus + revenue_rice + price * Math.abs(ml_bought);
  }

  // Build profit string
  let profitStr = '';
  const parts = [];
  if (ml_c > 0) parts.push(`220×${ml_c}`);
  if (ml_r > 0) parts.push(`160×${ml_r}`);
  
  if (parts.length > 0) {
    profitStr = parts.join(' + ');
    if (ml_bought > 0) {
      profitStr += ` − ${price}×${ml_bought}`;
    } else if (ml_bought < 0) {
      profitStr += ` + ${price}×${Math.abs(ml_bought)}`;
    }
  } else {
    if (ml_bought < 0) {
      profitStr = `${price}×${Math.abs(ml_bought)}`;
    } else {
      profitStr = '0';
    }
  }
  profitStr += ` = ${profit.toLocaleString()}`;

  const setCell = (id, val) => {
    const el = document.getElementById(`${id}_${i}`);
    el.textContent = val;
    el.classList.add('filled');
  };

  setCell('ml_citrus', ml_c);
  setCell('ml_rice', ml_r);
  setCell('ml_needed', ml_needed);
  setCell('ml_bought', ml_bought);
  document.getElementById(`profit_${i}`).textContent = profitStr;
  document.getElementById(`profit_${i}`).classList.add('filled');
}

function checkAnswers() {
  let correctCount = 0;
  let totalInputs = correctData.length * 2;
  let filledCount = 0;

  correctData.forEach((row, i) => {
    const citrusInput = document.getElementById(`citrus_${i}`);
    const riceInput = document.getElementById(`rice_${i}`);

    const ha_c = parseFloat(citrusInput.value);
    const ha_r = parseFloat(riceInput.value);

    // Citrus check
    if (!isNaN(ha_c)) {
      filledCount++;
      if (ha_c === row.ha_citrus) {
        citrusInput.classList.add('correct');
        citrusInput.classList.remove('incorrect');
        correctCount++;
      } else {
        citrusInput.classList.add('incorrect');
        citrusInput.classList.remove('correct');
      }
    } else {
      citrusInput.classList.remove('correct', 'incorrect');
    }

    // Rice check
    if (!isNaN(ha_r)) {
      filledCount++;
      if (ha_r === row.ha_rice) {
        riceInput.classList.add('correct');
        riceInput.classList.remove('incorrect');
        correctCount++;
      } else {
        riceInput.classList.add('incorrect');
        riceInput.classList.remove('correct');
      }
    } else {
      riceInput.classList.remove('correct', 'incorrect');
    }
  });

  const fb = document.getElementById('feedback');
  fb.classList.add('show');

  if (filledCount === 0) {
    fb.className = 'feedback show error';
    fb.innerHTML = 'Please fill in some values first! Enter the hectares of citrus and rice you would cultivate at each price.';
  } else if (correctCount === totalInputs) {
    fb.className = 'feedback show success';
    fb.innerHTML = `<span class="score-badge">✓ ${correctCount}/${totalInputs}</span> Excellent — all correct! You've correctly identified the profit-maximising cropping decisions at every price. Notice how the supply curve emerges: as the water price rises, you first stop growing the lower-value crop (rice at $160/ML), then the higher-value crop (citrus at $220/ML).`;
  } else if (correctCount >= totalInputs * 0.7) {
    fb.className = 'feedback show partial';
    fb.innerHTML = `<span class="score-badge">${correctCount}/${totalInputs}</span> Almost there! The cells highlighted in red need another look. Remember: you should cultivate a crop only if its yield per ML exceeds the market price for water.`;
  } else {
    fb.className = 'feedback show error';
    fb.innerHTML = `<span class="score-badge">${correctCount}/${filledCount} filled</span> Keep going — check the cells in red. Think about each crop's yield per ML of water: citrus yields $220/ML and rice yields $160/ML. At each price, ask yourself: "Am I better off using the water for this crop, or selling it?"`;
  }
}

function resetAll() {
  correctData.forEach((_, i) => {
    const citrusInput = document.getElementById(`citrus_${i}`);
    const riceInput = document.getElementById(`rice_${i}`);
    citrusInput.value = '';
    riceInput.value = '';
    citrusInput.classList.remove('correct', 'incorrect');
    riceInput.classList.remove('correct', 'incorrect');
    ['ml_citrus', 'ml_rice', 'ml_needed', 'ml_bought', 'profit'].forEach(c => {
      const el = document.getElementById(`${c}_${i}`);
      el.textContent = '—';
      el.classList.remove('filled');
    });
  });
  document.getElementById('feedback').classList.remove('show');
  document.getElementById('hint-box').classList.remove('show');
}

function toggleHint() {
  const box = document.getElementById('hint-box');
  const btn = document.querySelector('.btn-hint');
  box.classList.toggle('show');
  btn.textContent = box.classList.contains('show') ? 'Hide Hint' : 'Show Hint';
}

buildTable();
</script>

</body>
</html>
